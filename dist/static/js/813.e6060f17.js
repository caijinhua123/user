"use strict";(self["webpackChunkhello_world1"]=self["webpackChunkhello_world1"]||[]).push([[813],{829:function(t,e,n){n.d(e,{Z:function(){return L}});var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Form",t._g({},t.$listeners)),n("Comment",{attrs:{postcomment:t.postcomment,getComment:t.getComment,iscommentLoad:t.iscommentLoad}})],1)},a=[],o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("form",{ref:"sumb",on:{submit:function(e){return e.preventDefault(),t.postForm.apply(null,arguments)}}},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"name",attrs:{type:"text",maxlength:"10",placeholder:"请填写昵称"},domProps:{value:t.name},on:{input:[function(e){e.target.composing||(t.name=e.target.value)},t.clear]}}),n("span",{staticClass:"name_number"},[t._v(t._s(t.name.length)+"/10")]),n("p",[t._v(t._s(t.errName))]),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"content",attrs:{maxlength:"300",placeholder:"请填写评论"},domProps:{value:t.content},on:{input:[function(e){e.target.composing||(t.content=e.target.value)},t.clear]}},[t._v(t._s(t.content))]),n("span",{staticClass:"content_number"},[t._v(t._s(t.content.length)+"/300")]),n("p",[t._v(t._s(t.errcontent))]),n("button",{staticClass:"submit",attrs:{disabled:t.isLoad}},[t._v("提交")])])},i=[],r={components:{},data(){return{name:"",content:"",errName:"",errcontent:"",isLoad:!1}},methods:{postForm(t){""!==this.name?""!==this.content?(this.isLoad=!0,this.$emit("submit",this.name,this.content,(()=>{showMessage({content:"成功发表",type:"info",duration:1e3,container:this.$refs.sumb}),this.name="",this.content="",this.isLoad=!1}))):this.errcontent="请填写内容":this.errName="请填写昵称"},clear(){this.errcontent="",this.errName=""}}},c=r,l=n(736),m=(0,l.Z)(c,o,i,!1,null,"eac89b7e",null),d=m.exports,u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.getComment&&t.getComment.data&&t.getComment.data.rows?n("ul",{staticClass:"data-list-container"},[t._l(t.getComment.data.rows,(function(e){return n("li",[n("Header",{attrs:{src:e.avatar,size:44}}),n("div",{staticClass:"data"},[n("div",{staticClass:"nickname"},[t._v(t._s(e.nickname))]),n("div",{staticClass:"content"},[t._v(t._s(e.content))]),n("div",{staticClass:"time"},[t._v(t._s(t.Creatdata(e.createDate,!0)))])])],1)})),t.iscommentLoad?n("div",{staticClass:"load"},[t.iscommentLoad?n("Load"):t._e()],1):t._e()],2):t._e()},h=[],g=n(441),p=n(786),f=n(832),v={components:{Header:g.Z,Load:f.Z},data(){return{url:"https://qiheizhiya.oss-cn-shenzhen.aliyuncs.com/image/avatar6.jpg"}},props:{getComment:{Array:Array,default:[]},iscommentLoad:{}},methods:{Creatdata:p.Z}},_=v,$=(0,l.Z)(_,u,h,!1,null,"3b0322f9",null),S=$.exports,b={components:{Form:d,Comment:S},props:{postcomment:{Array:Array,default:[]},getComment:{Array:Array,default:[]},iscommentLoad:{}}},C=b,y=(0,l.Z)(C,s,a,!1,null,null,null),L=y.exports},327:function(t,e,n){n.d(e,{Z:function(){return l}});var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{staticClass:"right_list"},t._l(t.rightlist,(function(e,s){return n("li",[n("span",{class:{active:t.Select(e,s)},on:{click:function(n){return t.handleClick(e)}}},[t._v(" "+t._s(e.name)+" "),n("p",[t._v(t._s(e.articleCount)+" ")])]),n("List",{attrs:{rightlist:e.children},on:{select:t.handleClick}})],1)})),0)},a=[],o={name:"List",props:{rightlist:{Array:Array,default:()=>[]},total:{Number:Number,default:0},isSelect:{Number:Number,default:-1}},computed:{},methods:{handleClick(t){this.$emit("select",t)},Select(t,e){return t.isSelect?t.isSelect:this.isSelect===e}}},i=o,r=n(736),c=(0,r.Z)(i,s,a,!1,null,"b020f55e",null),l=c.exports},832:function(t,e,n){n.d(e,{Z:function(){return l}});var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("img",{attrs:{src:n(5)}})},a=[],o={},i=o,r=n(736),c=(0,r.Z)(i,s,a,!1,null,"565a1370",null),l=c.exports},813:function(t,e,n){n.r(e),n.d(e,{default:function(){return L}});var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Layout",{scopedSlots:t._u([{key:"main",fn:function(){return[n("div",{ref:"main",staticClass:"main"},[t.isLoad?t._e():n("Load"),n("Detail",{attrs:{detail:t.detaildata,creatdata:t.creatdata,to:"Blogcomment"}}),t.isLoad?n("Blogcomment",t._g({attrs:{iscommentLoad:t.iscommentLoad,postcomment:t.postcomment,getComment:t.getcomment,id:"Blogcomment"}},{submit:t.handle})):t._e()],1)]},proxy:!0},{key:"right",fn:function(){return[n("div",{staticClass:"right"},[n("h2",[t._v("目录 ")]),n("BlogRight",{attrs:{rightlist:t.change},on:{select:t.selectType}})],1)]},proxy:!0}])})},a=[],o=n(549),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.detail&&t.detail.title?n("div",{staticClass:"main"},[n("h1",[t._v(t._s(t.detail.title)+" ")]),n("span",[t._v("日期："+t._s(t.creat(t.detail.createDate)))]),n("span",[t._v("浏览："+t._s(t.detail.scanNumber))]),n("a",{attrs:{href:"#"+t.to}},[t._v("评论:"+t._s(t.detail.commentNumber))]),n("span",[t._v("分类: "+t._s(t.detail.id))]),n("div",{staticClass:"markdown-body",domProps:{innerHTML:t._s(t.detail.htmlContent)}})]):t._e()},r=[],c=n(786),l={props:{detail:{String:String,required:!0},creatdata:{Number:Number,default:0},to:{String:String}},data(){return{}},methods:{creat(t){return(0,c.Z)(t)}}},m=l,d=n(736),u=(0,d.Z)(m,i,r,!1,null,"1b5db2a6",null),h=u.exports,g=n(327),p=n(832),f=n(491),v=n(829),_=n(844),$=n(88),S=n(311),b={mixins:[(0,$.Z)("main")],components:{Layout:o.Z,Detail:h,BlogRight:g.Z,Load:p.Z,Blogcomment:v.Z},beforeDestroy(){console.log(this.$refs.main),this.$refs.main.removeEventListener("scroll",this.eventbus),this.$eventBus.$off("bottom",(0,_.Z)(this.addcomment)),this.$eventBus.$off("busScroll",(0,_.Z)(this.moveSelect))},data(){return{detaildata:()=>{},postcomment:()=>{},getcomment:()=>{},isLoad:!1,creatdata:0,toc:[],tocSelect:"",Doms:[],iscommentLoad:!1}},async beforeCreate(){console.log(this.$route.params.id);let t=await(0,f.qN)(this.$route.params.id);this.detaildata=t.data,S.Z.setRouter(this.detaildata.title),this.isLoad=!0,this.getcomment=await(0,f.d7)(),this.addchange(this.detaildata.toc),this.doms(),this.$refs.main.addEventListener("scroll",this.eventbus)},created(){this.$eventBus.$on("busScroll",(0,_.Z)(this.moveSelect)),this.$eventBus.$on("bottom",(0,_.Z)(this.addcomment))},methods:{eventbus(){if(this.$refs.main.scrollHeight>=this.$refs.main.scrollTop+this.$refs.main.clientHeight-10&&this.$refs.main.scrollHeight<=this.$refs.main.scrollTop+this.$refs.main.clientHeight+10){if(this.iscommentLoad)return;console.log("到达底部"),this.iscommentLoad=!0,this.$eventBus.$emit("bottom",this.$refs.main)}},async addcomment(){const t=await(0,f.d7)();this.iscommentLoad=!1,t.data.rows.length>=100||t.data.rows.map((t=>{this.getcomment.data.rows.push(t)}))},doms(){const t=e=>{e.map((e=>{this.Doms.push(document.getElementById(e.anchor)),e.children&&e.children&&t(e.children)}))};return t(this.toc)},selectType(t){location.hash=t.anchor,this.tocSelect=t.anchor,this.changeSelect(this.toc)},async handle(t,e,n){let s=t;this.postcomment=await(0,f.G_)({blogId:this.$route.params.id,nickname:s,content:e}),console.log(this.postcomment),this.getcomment.data.rows.unshift(this.postcomment.data),n()},addchange(t){return this.toc=t.map((t=>(t.isSelect=!1,t.children&&t.children.length&&this.addchange(t.children),t))),this.toc},changeSelect(t){return this.addchange(t),this.toc=t.map((t=>(t.anchor===this.tocSelect&&(t.isSelect=!0),t.children&&t.children.length&&this.changeSelect(t.children),t))),this.toc},moveSelect(){this.tocSelect="";for(const t of this.Doms)t&&(t.getBoundingClientRect().top<300&&t.getBoundingClientRect().top>0?this.tocSelect=t.id:t.getBoundingClientRect().top>300&&t.getBoundingClientRect().top<document.querySelector("body").clientHeight?this.Doms[this.Doms.indexOf(t)-1]&&(this.tocSelect=this.Doms[this.Doms.indexOf(t)-1].id):t.getBoundingClientRect().top<0&&this.Doms[this.Doms.indexOf(t)+1]&&this.Doms[this.Doms.indexOf(t)+1].getBoundingClientRect().top>300&&(this.tocSelect=t.id),this.changeSelect(this.toc))}},computed:{change(){const t=(e=[])=>e.map((e=>({...e,isSelect:e.anchor===this.tocSelect,children:t(e.children)})));return t(this.toc)},changeLoad(){return console.log("改变"),this.iscommentLoad}}},C=b,y=(0,d.Z)(C,s,a,!1,null,"220b065d",null),L=y.exports},491:function(t,e,n){n.d(e,{G_:function(){return r},d7:function(){return c},l3:function(){return a},qN:function(){return i},x3:function(){return o}});var s=n(908);async function a(t=-1,e=1,n=20){const a=await s.Z.get("/api/blog",{params:{categoryid:t,page:e,limit:n}});return a?a.data:a}async function o(){const t=await s.Z.get("/api/bloglist");return t?t.data:t}async function i(t){const e=await s.Z.get(`/api/blog/${t}`);return e}async function r(t){return await s.Z.post("/api/comment",t)}async function c(t,e,n){const a=await s.Z.get("/api/comment",{params:{page:t,limit:e,blogId:n}});return a}},88:function(t,e,n){function s(t){return{beforeDestroy(){this.$eventBus.$emit("busScroll"),this.$eventBus.$off("setMainScroll",this.handleScroll)},mounted(){console.log(this.$refs[t]),this.$refs[t].addEventListener("scroll",this.Eventbus)},created(){this.$eventBus.$on("setMainScroll",this.handleScroll)},methods:{handleScroll(e){console.log("返回顶部"),this.$refs[t].scrollTop=e},Eventbus(){this.$eventBus.$emit("busScroll",this.$refs[t])}}}}n.d(e,{Z:function(){return s}})},786:function(t,e,n){function s(t,e=!1){const n=new Date(+t),s=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getDate().toString().padStart(2,"0");if(e){const t=n.getHours().toString().padStart(2,"0"),e=n.getMinutes().toString().padStart(2,"0"),o=n.getSeconds().toString().padStart(2,"0");return`${n.getFullYear()}-${s}-${a} ${t}:${e}:${o}`}return`${n.getFullYear()}-${s}-${a}`}n.d(e,{Z:function(){return s}})},5:function(t,e,n){t.exports=n.p+"static/img/loading.89007415.svg"}}]);